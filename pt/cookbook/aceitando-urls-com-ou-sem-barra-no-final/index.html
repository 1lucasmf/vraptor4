<!DOCTYPE HTML> <html lang="pt"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Aceitando URLs com ou sem barra no final</title> <link rel="stylesheet" href="../css/style.min.css"/> </head> <body> <header class="container"><h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"></a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/#!forum/caelum-vraptor" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://www.guj.com.br/tag/vraptor" target="_blank">GUJ Respostas</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en not-selected" title="en" href="../../../en"> EN </a> </li> <li> <a class="site-language flag flag-pt " title="pt" href="../.."> PT </a> </li> </ul></header><input type="checkbox" id="nav-visibility"><label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"><ul> <li><a href="../../download">Download</a></li> <li><a href="../../docs/guia-de-1-minuto/">Documentação</a></li> <li><a href=".">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/issues/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul></nav><nav class="doc-nav container"><h1>Cookbook</h1> <ul> <li> <a href="."> Aceitando URLs com ou sem barra no final </a> </li> <li> <a href="../evitando-que-o-browser-faca-cache-das-paginas"> Evitando que o browser faça cache das páginas </a> </li> <li> <a href="../usando-o-header-referer-para-fazer-redirecionamentos"> Usando o Header Referer para fazer redirecionamentos </a> </li> </ul></nav><main class="container"><h1 id="por-tomaz-lavieri-adaptado-para-vraptor-4">por Tomaz Lavieri, adaptado para VRaptor 4</h1> <p>Para quem teve dificuldade como eu em conseguir determinar urls como:</p> <pre><code class="language-java"><span class="nd">@Path</span><span class="o">(</span><span class="s">"produto/{produto.id}"</span><span class="o">)</span></code></pre> <p>quando digitava a URI <strong>/produto/1/</strong> e o link não funcionava, segue abaixo uma modificação que corrige o problema.</p> <div class="note"> <h2 id="nota-do-editor">Nota do editor</h2> <p>Isso não é necessariamente um problema… a URL /abc é diferente da /abc/ portanto o comportamento de dar 404 é o esperado. Mas se você quiser que sejam urls equivalentes você pode escrever a classe abaixo.</p> </div> <pre><code class="language-java"><span class="kn">import</span> <span class="nn">javax.enterprise.context.RequestScoped</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.enterprise.inject.Specializes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">br.com.caelum.vraptor.Result</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">br.com.caelum.vraptor.controller.DefaultControllerNotFoundHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">br.com.caelum.vraptor.controller.HttpMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">br.com.caelum.vraptor.core.RequestInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">br.com.caelum.vraptor.http.route.ControllerNotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">br.com.caelum.vraptor.http.route.Router</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">br.com.caelum.vraptor.view.Results</span><span class="o">;</span>

<span class="nd">@RequestScoped</span>
<span class="nd">@Specializes</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Error404</span> <span class="kd">extends</span> <span class="n">DefaultControllerNotFoundHandler</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Router</span> <span class="n">router</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Result</span> <span class="n">result</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">public</span> <span class="nf">Error404</span><span class="o">(</span><span class="n">Router</span> <span class="n">router</span><span class="o">,</span> <span class="n">Result</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">router</span> <span class="o">=</span> <span class="n">router</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="cm">/**</span>
<span class="cm">     * @deprecated CDI eyes only</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">Error404</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">couldntFind</span><span class="o">(</span><span class="n">RequestInfo</span> <span class="n">requestInfo</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">requestInfo</span><span class="o">.</span><span class="na">getRequestedUri</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"/"</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">tryMovePermanentlyTo</span><span class="o">(</span><span class="n">requestInfo</span><span class="o">,</span> <span class="n">uri</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">uri</span><span class="o">.</span><span class="na">length</span><span class="o">()-</span><span class="mi">1</span><span class="o">));</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">tryMovePermanentlyTo</span><span class="o">(</span><span class="n">requestInfo</span><span class="o">,</span> <span class="n">uri</span> <span class="o">+</span> <span class="s">"/"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ControllerNotFoundException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">couldntFind</span><span class="o">(</span><span class="n">requestInfo</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">tryMovePermanentlyTo</span><span class="o">(</span><span class="n">RequestInfo</span> <span class="n">requestInfo</span><span class="o">,</span> <span class="n">String</span> <span class="n">newUri</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">router</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">newUri</span><span class="o">,</span> <span class="n">HttpMethod</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">requestInfo</span><span class="o">.</span><span class="na">getRequest</span><span class="o">()),</span>
            <span class="n">requestInfo</span><span class="o">.</span><span class="na">getRequest</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">Results</span><span class="o">.</span><span class="na">status</span><span class="o">()).</span><span class="na">movedPermanentlyTo</span><span class="o">(</span><span class="n">newUri</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre> </main> </body> </html>